<script>
    var currentMode = '';
    var menus = [];
    var clickCount = 0; 
    var isRolling = false;

    var defaultData = {
        lunch: ["ê¹€ì¹˜ì°Œê°œ", "ëœì¥ì°Œê°œ", "ë¶€ëŒ€ì°Œê°œ", "ìˆœë‘ë¶€ì°Œê°œ", "ì²­êµ­ì¥", "ë™íƒœì°Œê°œ", "ìœ¡ê°œì¥", "ë¼ˆí•´ì¥êµ­", "ìˆœëŒ€êµ­", "ë¼ì§€êµ­ë°¥", "ì„¤ë íƒ•", "ê°ˆë¹„íƒ•", "ì¶”ì–´íƒ•", "ë‹­ê³°íƒ•", "ê¹€ì¹˜ë³¶ìŒë°¥", "ì œìœ¡ë®ë°¥", "ì˜¤ì§•ì–´ë®ë°¥", "ë¹„ë¹”ë°¥", "ëŒì†¥ë¹„ë¹”ë°¥", "íšŒë®ë°¥", "ëˆê¹ŒìŠ¤", "ìƒì„ ê¹ŒìŠ¤", "ì¹˜í‚¨ê¹ŒìŠ¤", "ì¹´ë ˆë¼ì´ìŠ¤", "í•˜ì´ë¼ì´ìŠ¤", "ì§œì¥ë©´", "ì§¬ë½•", "ë³¶ìŒë°¥", "ì¡ì±„ë°¥", "ë§ˆë¼íƒ•", "ìŒ€êµ­ìˆ˜", "íŒŸíƒ€ì´", "ìš°ë™", "ë©”ë°€ì†Œë°”", "ë¼ë©˜", "í–„ë²„ê±°", "ìƒŒë“œìœ„ì¹˜", "ìƒëŸ¬ë“œ", "ê¹€ë°¥/ë¼ë©´", "ë–¡ë³¶ì´/íŠ€ê¹€"],
        dinner: ["ì‚¼ê²¹ì‚´", "ëª©ì‚´êµ¬ì´", "ë¼ì§€ê°ˆë¹„", "ì†Œê°ˆë¹„", "ì°¨ëŒë°•ì´", "í•œìš°ë“±ì‹¬", "ìŠ¤í…Œì´í¬", "ì–‘ê°ˆë¹„", "ì–‘ê¼¬ì¹˜", "ì œìœ¡ë³¶ìŒ", "ë‹­ê°ˆë¹„", "ì°œë‹­", "ì¹˜í‚¨", "ì „ê¸°í†µë‹­", "ìˆœì‚´ì¹˜í‚¨", "ì•„êµ¬ì°œ", "í•´ë¬¼ì°œ", "ì½”ë‹¤ë¦¬ì¡°ë¦¼", "ê³ ë“±ì–´ì¡°ë¦¼", "ê°ˆì¹˜ì¡°ë¦¼", "ê´‘ì–´íšŒ", "ì—°ì–´íšŒ", "ì°¸ì¹˜íšŒ", "ë¬¼íšŒ", "ì´ˆë°¥", "ì¡°ê°œêµ¬ì´", "ì¥ì–´êµ¬ì´", "ë§¤ìš´íƒ•", "ê³±ì°½êµ¬ì´", "ëŒ€ì°½êµ¬ì´", "ë§‰ì°½êµ¬ì´", "ê³±ì°½ì „ê³¨", "ë¶ˆê³ ê¸°", "ìƒ¤ë¸Œìƒ¤ë¸Œ", "ìŠ¤í‚¤ì•¼í‚¤", "ë°€í‘€ìœ ë‚˜ë² ", "ê°ìíƒ•", "ë“±ê°ˆë¹„ì°œ", "ì¡±ë°œ", "ë³´ìŒˆ", "ëƒ‰ë©´/í¸ìœ¡", "ìœ¡íšŒ", "íŒŒì „/ë§‰ê±¸ë¦¬", "ê³¨ë±…ì´ì†Œë©´", "ë¨¹íƒœ/ë…¸ê°€ë¦¬", "ë–¡ë³¶ì´/ìˆœëŒ€", "ë‹­ë°œ", "ì˜¤ëŒë¼ˆ", "ë¼ì§€ê»ë°ê¸°", "í”¼ì", "íŒŒìŠ¤íƒ€", "ë¦¬ì¡°ë˜", "ë¼ìëƒ", "ê°ë°”ìŠ¤", "íƒ•ìˆ˜ìœ¡", "ì–‘ì¥í”¼", "íŒ”ë³´ì±„", "ê¹í’ê¸°", "ìœ ì‚°ìŠ¬", "í› ê¶ˆ"]
    };

    // âœ… [ìˆ˜ì •] ì•ˆë“œë¡œì´ë“œ ì „ìš© ê´‘ê³  í˜¸ì¶œ í•¨ìˆ˜
    function callAdmob() {
        if (window.Android && window.Android.onMenuClick) {
            window.Android.onMenuClick(); // ìš°ë¦¬ê°€ ë§Œë“  MainActivityì˜ í•¨ìˆ˜ í˜¸ì¶œ
        } else {
            console.log("ì¼ë°˜ ë¸Œë¼ìš°ì € í™˜ê²½ì…ë‹ˆë‹¤.");
        }
    }

    function goApp(m) {
        currentMode = m;
        document.getElementById('home').classList.remove('visible');
        document.getElementById('app').classList.add('visible');
        document.getElementById('title').innerText = (m === 'lunch' ? "â˜€ï¸ ì ì‹¬ ì¶”ì²œ" : "ğŸŒ™ ì €ë… ì¶”ì²œ");
        document.getElementById('pickBtn').style.background = (m === 'lunch' ? 'var(--lunch)' : 'var(--dinner)');
        var saved = localStorage.getItem('food_v18_' + m);
        menus = saved ? JSON.parse(saved) : [...defaultData[m]];
        render();
    }

    function render() {
        var html = '';
        for(var i=0; i<menus.length; i++) {
            html += '<div class="menu-item"><span>'+menus[i]+'</span><span style="color:#ff4d4d; font-weight:bold; padding:5px 10px; cursor:pointer;" onclick="delMenu('+i+')">âœ•</span></div>';
        }
        document.getElementById('menuListView').innerHTML = html;
        document.getElementById('menuCount').innerText = menus.length;
        localStorage.setItem('food_v18_' + currentMode, JSON.stringify(menus));
    }

    function startRolling() {
        if (isRolling || menus.length === 0) return;
        isRolling = true;
        
        var slot = document.getElementById('slot-machine');
        var duration = 1500; 
        var start = Date.now();
        
        var timer = setInterval(function() {
            slot.innerText = menus[Math.floor(Math.random() * menus.length)];
            if (Date.now() - start > duration) {
                clearInterval(timer);
                isRolling = false;
                showResult(slot.innerText);

                // âœ… [ìˆ˜ì •] ë©”ë‰´ë¥¼ ë½‘ì•˜ì„ ë•Œë§Œ ê´‘ê³  ì¹´ìš´íŠ¸ ì‹ í˜¸ë¥¼ ë³´ëƒ„
                callAdmob(); 
            }
        }, 80);
    }

    function showResult(menu) {
        document.getElementById('resultName').innerText = menu;
        document.getElementById('modal').style.display = 'flex';
    }

    function addMenu() {
        var val = document.getElementById('menuInput').value.trim();
        if(val) { menus.unshift(val); document.getElementById('menuInput').value = ''; render(); }
    }

    function delMenu(i) { menus.splice(i, 1); render(); }
    function closeModal() { document.getElementById('modal').style.display = 'none'; }

    // âœ… [ìˆ˜ì •] ì§€ë„ ì•± ê°•ì œ ì—°ë™ì„ ìœ„í•´ window.location.href ì‚¬ìš©
    function openMap(type) {
        var name = document.getElementById('resultName').innerText;
        var q = encodeURIComponent(name + " í˜„ì§€ì¸ ë§›ì§‘");
        
        if (type === 'naver') {
            // ë„¤ì´ë²„ ì§€ë„ ì•± í˜¸ì¶œ ìŠ¤í‚´
            window.location.href = 'nmap://search?query=' + q + '&appname=com.myname.randommenu';
        } else {
            // ì¹´ì¹´ì˜¤ ì§€ë„ ì•± í˜¸ì¶œ ìŠ¤í‚´
            window.location.href = 'kakaomap://search?q=' + q;
        }

        // ë§Œì•½ ì•±ì´ ì•ˆê¹”ë ¤ ìˆì„ ê²½ìš°ë¥¼ ëŒ€ë¹„í•œ 2ì´ˆ í›„ ì›¹ ì´ë™ (ë³´í—˜)
        setTimeout(function() {
            var webUrl = (type === 'naver') 
                ? 'https://m.map.naver.com/search2/search.naver?query=' + q 
                : 'https://map.kakao.com/link/search/' + q;
            window.location.href = webUrl;
        }, 2000);
    }
</script>
